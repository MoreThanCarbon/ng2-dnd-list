!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/Subject"),require("@angular/common")):"function"==typeof define&&define.amd?define("@fjsc/ng-dnd-list",["exports","@angular/core","rxjs/Subject","@angular/common"],t):t((e.fjsc=e.fjsc||{},e.fjsc["ng-dnd-list"]={}),e.ng.core,e.Rx,e.ng.common)}(this,function(e,n,t,r){"use strict";function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),d=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)d.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(i)throw i.error}}return d}var i=function(){function e(){this._isDragging=!1,this._itemType="",this._removeOnDrop=!1,this.dropEndSource=new t.Subject}return e.prototype.setDraggingState=function(e){this._isDragging=e},e.prototype.getDraggingState=function(){return this._isDragging},e.prototype.setItemType=function(e){this._itemType=e.toLowerCase()},e.prototype.getItemType=function(){return this._itemType},e.prototype.setDropCallback=function(e){this._dropCallback=e},e.prototype.getDropCallback=function(){return this._dropCallback},e.prototype.setDropEffect=function(e){this._dropEffect=e},e.prototype.getDropEffect=function(){return this._dropEffect},e.prototype.setEffectAllowed=function(e){this._effectAllowed=e},e.prototype.getEffectAllowed=function(){return this._effectAllowed},e.prototype.setRemoveOnDrop=function(e){this._removeOnDrop=e},e.prototype.getRemoveOnDrop=function(){return this._removeOnDrop},e}();i.decorators=[{type:n.Injectable}],i.ctorParameters=function(){return[]};var d="application/x-dnd",l="application/json",g="Text",s=["move","copy","link"],o=function(){function e(e,t,r){this._dndService=e,this._renderer=t,this.dndType="",this.dndDragstart=new n.EventEmitter,this.dndDragend=new n.EventEmitter,this.dndSelected=new n.EventEmitter,this.dndMoved=new n.EventEmitter,this.dndCopied=new n.EventEmitter,this.dndLinked=new n.EventEmitter,this.dndCanceled=new n.EventEmitter,this._nativeElement=r.nativeElement}return Object.defineProperty(e.prototype,"draggable",{get:function(){return!this.dndDisable},enumerable:!0,configurable:!0}),e.prototype.onDragStart=function(e){var t=this;if(e=e.originalEvent||e,!this.draggable)return!0;this._dndService.setDraggingState(!0),this._dndService.setItemType(this.dndType);var r=d+(this._dndService.getItemType()?"-"+this._dndService.getItemType():"");this._dndService.setDropEffect("none"),this._dndService.setEffectAllowed(this.dndEffectAllowed||s[0]),e.dataTransfer.effectAllowed=this._dndService.getEffectAllowed();try{e.dataTransfer.setData(r,JSON.stringify(this.dndDraggable))}catch(o){var n={item:this.dndDraggable,type:this._dndService.getItemType()};try{e.dataTransfer.setData(l,JSON.stringify(n))}catch(o){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData(g,JSON.stringify(n))}}if(this._renderer.addClass(this._nativeElement,"dndDragging"),setTimeout(function(){return t._renderer.addClass(t._nativeElement,"dndDraggingSource")},0),e._dndHandle&&e.dataTransfer.setDragImage&&e.dataTransfer.setDragImage(this._nativeElement,0,0),this.dndDragstart.emit(e),this.dndCallback){var i=this.dndCallback;this._dndService.setDropCallback(function(e){return i(e)})}e.stopPropagation()},e.prototype.onDragEnd=function(e){var t=this,r=this._dndService.getDropEffect();this[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[r]].emit(e),this.dndDragend.emit({event:e,dropEffect:r}),this._dndService.setDraggingState(!1),this._dndService.setDropCallback(undefined),this._dndService.setRemoveOnDrop(!1),this._renderer.removeClass(this._nativeElement,"dndDragging"),this._renderer.removeClass(this._nativeElement,"dndDraggingSource"),e.stopPropagation(),setTimeout(function(){return t._renderer.removeClass(t._nativeElement,"dndDraggingSource")},0)},e.prototype.click=function(e){this.dndSelected.emit(e),e.stopPropagation()},e}();o.decorators=[{type:n.Directive,args:[{selector:"[dndDraggable]"}]}],o.ctorParameters=function(){return[{type:i},{type:n.Renderer2},{type:n.ElementRef}]},o.propDecorators={dndDraggable:[{type:n.Input}],dndDisable:[{type:n.Input}],dndType:[{type:n.Input}],dndCallback:[{type:n.Input}],dndEffectAllowed:[{type:n.Input}],dndDragstart:[{type:n.Output}],dndDragend:[{type:n.Output}],dndSelected:[{type:n.Output}],dndMoved:[{type:n.Output}],dndCopied:[{type:n.Output}],dndLinked:[{type:n.Output}],dndCanceled:[{type:n.Output}],draggable:[{type:n.HostBinding,args:["draggable"]}],onDragStart:[{type:n.HostListener,args:["dragstart",["$event"]]}],onDragEnd:[{type:n.HostListener,args:["dragend",["$event"]]}],click:[{type:n.HostListener,args:["click",["$event"]]}]};var a=function(){function e(e,t,r){this._el=e,this._renderer=t,this._dndService=r,this.dndDisable=!1,this.dndListChange=new n.EventEmitter,this.dndDragover=new n.EventEmitter,this.dndDrop=new n.EventEmitter,this.dndInserted=new n.EventEmitter,this._listSettings={},this._dragOverStopped=!1,this._counter=0,this._nativeElement=this._el.nativeElement}return e.prototype.ngOnInit=function(){var e=this._getPlaceholderElement();e.remove(),this._placeholderNode=e,this._listNode=this._nativeElement},e.prototype.onDragEnter=function(e){this._counter++,this._dragOverStopped=!1,e=e.originalEvent||e,this._listSettings={allowedTypes:Array.isArray(this.dndAllowedTypes)&&this.dndAllowedTypes.join("|").toLowerCase().split("|"),disabled:this.dndDisable,externalSources:this.dndExternalSources,horizontal:this.dndHorizontalList};var t=this._getMimeType(e.dataTransfer.types);if(!t||!this._isDropAllowed(this._getItemType(t)))return!0;e.preventDefault()},e.prototype.onDragOver=function(e){e=e.originalEvent||e;var t=this._getMimeType(e.dataTransfer.types),r=this._getItemType(t);if(!t||!this._isDropAllowed(r))return!0;if(this._placeholderNode.parentNode!==this._listNode&&this._renderer.appendChild(this._nativeElement,this._placeholderNode),e.target!==this._listNode){for(var n=e.target;n.parentNode!==this._listNode&&n.parentNode;)n=n.parentNode;if(n.parentNode===this._listNode&&n!==this._placeholderNode){var i=n.getBoundingClientRect(),o=void 0;o=this._listSettings.horizontal?e.clientX<i.left+i.width/2:e.clientY<i.top+i.height/2,this._listNode.insertBefore(this._placeholderNode,o?n:n.nextSibling)}}var d=t===g,s=this._getDropEffect(e,d);return"none"===s?this._stopDragover():(this.dndDragover.emit(this._getEventResponse(e,s,r)),this._dragOverStopped?this._stopDragover():(e.preventDefault(),d||(e.dataTransfer.dropEffect=s),this._renderer.addClass(this._nativeElement,"dndDragover"),e.stopPropagation(),!1))},e.prototype.onDrop=function(e){this._counter=0,e=e.originalEvent||e;var t,r=this._getMimeType(e.dataTransfer.types),n=this._getItemType(r);if(!r||!this._isDropAllowed(n))return!0;e.preventDefault();try{t=JSON.parse(e.dataTransfer.getData(r))}catch(a){return this._stopDragover()}if((r===g||r===l)&&(n=t.type||undefined,t=t.item,!this._isDropAllowed(n)))return this._stopDragover();var i=r===g,o=this._getDropEffect(e,i);if("none"===o)return this._stopDragover();var d=this._getPlaceholderIndex();if(this.dndDrop.emit(this._getEventResponse(e,o,n,d,t)),this._dragOverStopped)return this._stopDragover();if(this._dndService.setDropEffect(o),i||(e.dataTransfer.dropEffect=o),this.dndList&&this.dndList.length){var s=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}(this.dndList.slice(0,d),[t],this.dndList.slice(d));this.dndListChange.emit(s)}return this._dndService.setRemoveOnDrop(!0),this.dndInserted.emit(this._getEventResponse(e,o,n,d,t)),this._stopDragover(),e.stopPropagation(),!1},e.prototype.onDragLeave=function(e){this._counter--,e=e.originalEvent||e,0!==this._counter?e._dndPhShown=!0:this._stopDragover()},e.prototype.onmouseout=function(e){this._dndService.getDraggingState()&&this._stopDragover()},e.prototype._stopDrag=function(){this._dragOverStopped=!0},e.prototype._stopDragover=function(){return this._placeholderNode.remove(),this._renderer.removeClass(this._nativeElement,"dndDragover"),!0},e.prototype._getEventResponse=function(e,t,r,n,i){return{callback:this._dndService.getDropCallback(),dropEffect:t,event:e,external:!this._dndService.getDraggingState(),index:n!==undefined?n:this._getPlaceholderIndex(),item:i||undefined,stopDragover:this._stopDrag.bind(this),type:r}},e.prototype._getPlaceholderIndex=function(){return Array.prototype.indexOf.call(this._nativeElement.children,this._placeholderNode)},e.prototype._getPlaceholderElement=function(){var e=[].slice.call(this._nativeElement.children).filter(function(e){return-1<e.className.indexOf("dndPlaceholder")});return e.length||(e=this._renderer.createElement("li"),this._renderer.addClass(e,"dndPlaceholder")),e},e.prototype._getMimeType=function(e){if(!e)return g;for(var t=0;t<e.length;t++)if(e[t]===g||e[t]===l||e[t].substr(0,d.length)===d)return e[t];return null},e.prototype._getItemType=function(e){return this._dndService.getDraggingState()?this._dndService.getItemType()||undefined:e===g||e===l?null:e&&e.substr(d.length+1)||undefined},e.prototype._isDropAllowed=function(e){return!this._listSettings.disabled&&(!(!this._listSettings.externalSources&&!this._dndService.getDraggingState())&&(!this._listSettings.allowedTypes||null===e||e&&-1!==this._listSettings.allowedTypes.indexOf(e)))},e.prototype._getDropEffect=function(e,t){var r=s;return t||(r=this._filterEffects(r,e.dataTransfer.effectAllowed)),this._dndService.getDraggingState()&&(r=this._filterEffects(r,this._dndService.getEffectAllowed())),this.dndEffectAllowed&&(r=this._filterEffects(r,this.dndEffectAllowed)),r.length?e.ctrlKey&&-1!==r.indexOf("copy")?"copy":e.altKey&&-1!==r.indexOf("link")?"link":r[0]:"none"},e.prototype._filterEffects=function(e,t){return"all"===t?e:e.filter(function(e){return-1!==t.toLowerCase().indexOf(e)})},e}();a.decorators=[{type:n.Directive,args:[{selector:"[dndList]"}]}],a.ctorParameters=function(){return[{type:n.ElementRef},{type:n.Renderer2},{type:i}]},a.propDecorators={dndDisable:[{type:n.Input}],dndAllowedTypes:[{type:n.Input}],dndExternalSources:[{type:n.Input}],dndHorizontalList:[{type:n.Input}],dndEffectAllowed:[{type:n.Input}],pureComponent:[{type:n.Input}],dndList:[{type:n.Input}],dndListChange:[{type:n.Output}],dndDragover:[{type:n.Output}],dndDrop:[{type:n.Output}],dndInserted:[{type:n.Output}],onDragEnter:[{type:n.HostListener,args:["dragenter",["$event"]]}],onDragOver:[{type:n.HostListener,args:["dragover",["$event"]]}],onDrop:[{type:n.HostListener,args:["drop",["$event"]]}],onDragLeave:[{type:n.HostListener,args:["dragleave",["$event"]]}],onmouseout:[{type:n.HostListener,args:["mouseleave",["$event"]]}]};var c=function(){function e(){}return Object.defineProperty(e.prototype,"draggable",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.onDragStart=function(e){(e=e.originalEvent||e)._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())},e.prototype.onDragEnd=function(e){(e=e.originalEvent||e)._dndHandle||e.stopPropagation()},e}();c.decorators=[{type:n.Directive,args:[{selector:"[dndNodrag]"}]}],c.propDecorators={draggable:[{type:n.HostBinding,args:["draggable"]}],onDragStart:[{type:n.HostListener,args:["dragstart",["$event"]]}],onDragEnd:[{type:n.HostListener,args:["dragend",["$event"]]}]};var f=function(){function e(){}return Object.defineProperty(e.prototype,"draggable",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.onDragStart=function(e){(e=e.originalEvent||e)._dndHandle=!0},e}();f.decorators=[{type:n.Directive,args:[{selector:"[dndHandle]"}]}],f.propDecorators={draggable:[{type:n.HostBinding,args:["draggable"]}],onDragStart:[{type:n.HostListener,args:["dragstart dragend",["$event"]]}]};var h=[o,a,c,f],u=function(){};u.decorators=[{type:n.NgModule,args:[{imports:[r.CommonModule],declarations:h,providers:[i],exports:h}]}],e.DndListModule=u,e.DndDraggableDirective=o,e.DndHandleDirective=f,e.DndListDirective=a,e.DndNodragDirective=c,e.ɵa=o,e.ɵe=f,e.ɵc=a,e.ɵd=c,e.ɵb=i,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=fjsc-ng-dnd-list.umd.min.js.map
